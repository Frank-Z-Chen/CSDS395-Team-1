{"ast":null,"code":"import \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.object.seal.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport t from \"vue\";\nimport { SlateTransforms as e, SlateEditor as o, createEditor as r, DomEditor as n, createToolbar as i } from \"@wangeditor/editor\";\n/*! *****************************************************************************\nCopyright (c) Microsoft Corporation.\n\nPermission to use, copy, modify, and/or distribute this software for any\npurpose with or without fee is hereby granted.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\nPERFORMANCE OF THIS SOFTWARE.\n***************************************************************************** */\n\nvar _a = function a() {\n  return _a = Object.assign || function (t) {\n    for (var e, o = 1, r = arguments.length; o < r; o++) {\n      for (var n in e = arguments[o]) {\n        Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n]);\n      }\n    }\n\n    return t;\n  }, _a.apply(this, arguments);\n};\n\nfunction s(t) {\n  var e = \"请使用 '@\".concat(t, \"' 事件，不要放在 props 中\");\n  return e += \"\\nPlease use '@\".concat(t, \"' event instead of props\");\n}\n\nvar u = t.extend({\n  render: function render(t) {\n    return t(\"div\", {\n      ref: \"box\"\n    });\n  },\n  name: \"Editor\",\n  data: function data() {\n    return {\n      curValue: \"\",\n      editor: null\n    };\n  },\n  props: [\"defaultContent\", \"defaultConfig\", \"mode\", \"defaultHtml\", \"value\"],\n  mounted: function mounted() {\n    this.create();\n  },\n  watch: {\n    value: function value(t) {\n      t === this.curValue || this.setHtml(t);\n    }\n  },\n  methods: {\n    setHtml: function setHtml(t) {\n      var r = this.editor;\n\n      if (null != r) {\n        var n = r.isDisabled(),\n            i = r.isFocused(),\n            a = JSON.stringify(r.selection);\n        if (r.enable(), r.focus(), r.select([]), r.deleteFragment(), e.setNodes(r, {\n          type: \"paragraph\"\n        }, {\n          mode: \"highest\"\n        }), r.dangerouslyInsertHtml(t), i || (r.deselect(), r.blur()), n && (r.deselect(), r.disable()), r.isFocused()) try {\n          r.select(JSON.parse(a));\n        } catch (t) {\n          r.select(o.start(r, []));\n        }\n      }\n    },\n    create: function create() {\n      var t = this;\n\n      if (null != this.$refs.box) {\n        var e = this.defaultConfig || {},\n            o = JSON.stringify(Array.isArray(this.defaultContent) ? this.defaultContent : []);\n        r({\n          selector: this.$refs.box,\n          html: this.defaultHtml || this.value || \"\",\n          config: _a(_a({}, e), {\n            onCreated: function onCreated(o) {\n              if (t.editor = Object.seal(o), t.$emit(\"onCreated\", o), e.onCreated) {\n                var r = s(\"onCreated\");\n                throw new Error(r);\n              }\n            },\n            onChange: function onChange(o) {\n              var r = o.getHtml();\n\n              if (t.curValue = r, t.$emit(\"input\", r), t.$emit(\"onChange\", o), e.onChange) {\n                var n = s(\"onChange\");\n                throw new Error(n);\n              }\n            },\n            onDestroyed: function onDestroyed(o) {\n              if (t.$emit(\"onDestroyed\", o), e.onDestroyed) {\n                var r = s(\"onDestroyed\");\n                throw new Error(r);\n              }\n            },\n            onMaxLength: function onMaxLength(o) {\n              if (t.$emit(\"onMaxLength\", o), e.onMaxLength) {\n                var r = s(\"onMaxLength\");\n                throw new Error(r);\n              }\n            },\n            onFocus: function onFocus(o) {\n              if (t.$emit(\"onFocus\", o), e.onFocus) {\n                var r = s(\"onFocus\");\n                throw new Error(r);\n              }\n            },\n            onBlur: function onBlur(o) {\n              if (t.$emit(\"onBlur\", o), e.onBlur) {\n                var r = s(\"onBlur\");\n                throw new Error(r);\n              }\n            },\n            customAlert: function customAlert(o, r) {\n              if (t.$emit(\"customAlert\", o, r), e.customAlert) {\n                var n = s(\"customAlert\");\n                throw new Error(n);\n              }\n            },\n            customPaste: function customPaste(o, r) {\n              if (e.customPaste) {\n                var n = s(\"customPaste\");\n                throw new Error(n);\n              }\n\n              var i;\n              return t.$emit(\"customPaste\", o, r, function (t) {\n                i = t;\n              }), i;\n            }\n          }),\n          content: JSON.parse(o),\n          mode: this.mode || \"default\"\n        });\n      }\n    }\n  }\n}),\n    l = t.extend({\n  name: \"Toolbar\",\n  render: function render(t) {\n    return t(\"div\", {\n      ref: \"box\"\n    });\n  },\n  props: [\"editor\", \"defaultConfig\", \"mode\"],\n  methods: {\n    create: function create(t) {\n      null != this.$refs.box && null != t && (n.getToolbar(t) || i({\n        editor: t,\n        selector: this.$refs.box,\n        config: this.defaultConfig || {},\n        mode: this.mode || \"default\"\n      }));\n    }\n  },\n  watch: {\n    editor: {\n      handler: function handler(t) {\n        null != t && this.create(t);\n      },\n      immediate: !0\n    }\n  }\n});\nexport { u as Editor, l as Toolbar };","map":{"version":3,"mappings":"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","names":["genErrorInfo","fnName","info","Vue","extend","render","h","ref","name","data","curValue","editor","props","mounted","this","create","watch","value","newVal","setHtml","methods","newHtml","isEditorDisabled","isDisabled","isEditorFocused","isFocused","editorSelectionStr","JSON","stringify","selection","enable","focus","select","deleteFragment","SlateTransforms","setNodes","type","mode","dangerouslyInsertHtml","deselect","blur","disable","parse","ex","SlateEditor","start","$refs","box","defaultConfig","defaultContent","Array","isArray","createEditor","selector","html","defaultHtml","config","onCreated","_this","Object","seal","$emit","Error","onChange","editorHtml","getHtml","onDestroyed","onMaxLength","onFocus","onBlur","customAlert","info_1","customPaste","event","res","val","content","l","DomEditor","getToolbar","createToolbar","handler","e","immediate"],"sources":["../src/components/Editor.vue","../src/components/Toolbar.vue"],"sourcesContent":["<script lang=\"ts\">\nimport Vue from 'vue';\nimport { createEditor, SlateTransforms, SlateEditor } from '@wangeditor/editor';\n\nfunction genErrorInfo(fnName: string) {\n  let info = `请使用 '@${fnName}' 事件，不要放在 props 中`;\n  info += `\\nPlease use '@${fnName}' event instead of props`;\n  return info;\n}\n\nexport default Vue.extend({\n  //【注意】单独写 <template>...</template> 时，rollup 打包完浏览器运行时报错，所以先在这里写 template\n  render(h) {\n    return h('div', { ref: 'box' });\n  },\n  name: 'Editor',\n  data() {\n    return {\n      curValue: '',\n      editor: null,\n    };\n  },\n  props: ['defaultContent', 'defaultConfig', 'mode', 'defaultHtml', 'value'], // value 用于自定义 v-model\n  mounted() {\n    this.create();\n  },\n  watch: {\n    // 监听 'value' 属性变化 - value 用于自定义 v-model\n    value(newVal) {\n      const isEqual = newVal === this.curValue\n      if (isEqual) return // 和当前内容一样，则忽略\n\n      // 重置 HTML\n      this.setHtml(newVal);\n    },\n  },\n  methods: {\n    // 重置 HTML\n    setHtml(newHtml: string) {\n      const editor = this.editor as any;\n      if (editor == null) return;\n\n      // 记录编辑器当前状态\n      const isEditorDisabled = editor.isDisabled();\n      const isEditorFocused = editor.isFocused();\n      const editorSelectionStr = JSON.stringify(editor.selection);\n\n      // 删除并重新设置 HTML\n      editor.enable();\n      editor.focus();\n      editor.select([]);\n      editor.deleteFragment();\n      // @ts-ignore\n      SlateTransforms.setNodes(editor, { type: 'paragraph' }, { mode: 'highest' });\n      editor.dangerouslyInsertHtml(newHtml);\n\n      // 恢复编辑器状态\n      if (!isEditorFocused) {\n        editor.deselect();\n        editor.blur();\n      }\n      if (isEditorDisabled) {\n        editor.deselect();\n        editor.disable();\n      }\n\n      if (editor.isFocused()) {\n        try {\n          editor.select(JSON.parse(editorSelectionStr)); // 选中原来的位置\n        } catch (ex) {\n          editor.select(SlateEditor.start(editor, [])); // 选中开始\n        }\n      }\n    },\n\n    // 创建 editor\n    create() {\n      if (this.$refs.box == null) return;\n\n      const defaultConfig = this.defaultConfig || {};\n\n      const defaultContent = JSON.stringify(\n        Array.isArray(this.defaultContent) ? this.defaultContent : []\n      );\n\n      createEditor({\n        selector: this.$refs.box as Element,\n        html: this.defaultHtml || this.value || '',\n        config: {\n          ...defaultConfig,\n          onCreated: (editor) => {\n            this.editor = Object.seal(editor) as any; // 注意，一定要用 Object.seal() 否则会报错\n\n            this.$emit('onCreated', editor);\n            if (defaultConfig.onCreated) {\n              const info = genErrorInfo('onCreated');\n              throw new Error(info);\n            }\n          },\n          onChange: (editor) => {\n            const editorHtml = editor.getHtml()\n            this.curValue = editorHtml // 记录当前 html 内容\n            this.$emit('input', editorHtml); // 用于自定义 v-model\n\n            this.$emit('onChange', editor);\n            if (defaultConfig.onChange) {\n              const info = genErrorInfo('onChange');\n              throw new Error(info);\n            }\n          },\n          onDestroyed: (editor) => {\n            this.$emit('onDestroyed', editor);\n            if (defaultConfig.onDestroyed) {\n              const info = genErrorInfo('onDestroyed');\n              throw new Error(info);\n            }\n          },\n          onMaxLength: (editor) => {\n            this.$emit('onMaxLength', editor);\n            if (defaultConfig.onMaxLength) {\n              const info = genErrorInfo('onMaxLength');\n              throw new Error(info);\n            }\n          },\n          onFocus: (editor) => {\n            this.$emit('onFocus', editor);\n            if (defaultConfig.onFocus) {\n              const info = genErrorInfo('onFocus');\n              throw new Error(info);\n            }\n          },\n          onBlur: (editor) => {\n            this.$emit('onBlur', editor);\n            if (defaultConfig.onBlur) {\n              const info = genErrorInfo('onBlur');\n              throw new Error(info);\n            }\n          },\n          customAlert: (info, type) => {\n            this.$emit('customAlert', info, type);\n            if (defaultConfig.customAlert) {\n              const info = genErrorInfo('customAlert');\n              throw new Error(info);\n            }\n          },\n          customPaste: (editor, event) => {\n            if (defaultConfig.customPaste) {\n              const info = genErrorInfo('customPaste');\n              throw new Error(info);\n            }\n            let res;\n            this.$emit('customPaste', editor, event, (val: any) => {\n              res = val;\n            });\n            return res;\n          },\n        },\n        content: JSON.parse(defaultContent),\n        mode: this.mode || 'default',\n      });\n    },\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport Vue from 'vue';\nimport { createToolbar, DomEditor } from '@wangeditor/editor';\n\nexport default Vue.extend({\n  name: 'Toolbar',\n  render(h) {\n    return h('div', { ref: 'box' });\n  },\n  props: ['editor', 'defaultConfig', 'mode'],\n  methods: {\n    // 创建 toolbar\n    create(editor: any) {\n      if (this.$refs.box == null) return;\n      if (editor == null) return;\n      if (DomEditor.getToolbar(editor)) return // 不重复创建\n\n      createToolbar({\n        editor,\n        selector: this.$refs.box as Element,\n        config: this.defaultConfig || {},\n        mode: this.mode || 'default',\n      });\n    },\n  },\n  watch: {\n    editor: {\n      handler(e) {\n        if (e == null) return;\n        this.create(e);\n      },\n      immediate: true,\n    }\n  }\n});\n</script>\n"]},"metadata":{},"sourceType":"module"}