{"version":3,"file":"index.esm.js","sources":["../src/components/Editor.vue","../src/components/Toolbar.vue"],"sourcesContent":["<script lang=\"ts\">\nimport Vue from 'vue';\nimport { createEditor, SlateTransforms, SlateEditor } from '@wangeditor/editor';\n\nfunction genErrorInfo(fnName: string) {\n  let info = `请使用 '@${fnName}' 事件，不要放在 props 中`;\n  info += `\\nPlease use '@${fnName}' event instead of props`;\n  return info;\n}\n\nexport default Vue.extend({\n  //【注意】单独写 <template>...</template> 时，rollup 打包完浏览器运行时报错，所以先在这里写 template\n  render(h) {\n    return h('div', { ref: 'box' });\n  },\n  name: 'Editor',\n  data() {\n    return {\n      curValue: '',\n      editor: null,\n    };\n  },\n  props: ['defaultContent', 'defaultConfig', 'mode', 'defaultHtml', 'value'], // value 用于自定义 v-model\n  mounted() {\n    this.create();\n  },\n  watch: {\n    // 监听 'value' 属性变化 - value 用于自定义 v-model\n    value(newVal) {\n      const isEqual = newVal === this.curValue\n      if (isEqual) return // 和当前内容一样，则忽略\n\n      // 重置 HTML\n      this.setHtml(newVal);\n    },\n  },\n  methods: {\n    // 重置 HTML\n    setHtml(newHtml: string) {\n      const editor = this.editor as any;\n      if (editor == null) return;\n\n      // 记录编辑器当前状态\n      const isEditorDisabled = editor.isDisabled();\n      const isEditorFocused = editor.isFocused();\n      const editorSelectionStr = JSON.stringify(editor.selection);\n\n      // 删除并重新设置 HTML\n      editor.enable();\n      editor.focus();\n      editor.select([]);\n      editor.deleteFragment();\n      // @ts-ignore\n      SlateTransforms.setNodes(editor, { type: 'paragraph' }, { mode: 'highest' });\n      editor.dangerouslyInsertHtml(newHtml);\n\n      // 恢复编辑器状态\n      if (!isEditorFocused) {\n        editor.deselect();\n        editor.blur();\n      }\n      if (isEditorDisabled) {\n        editor.deselect();\n        editor.disable();\n      }\n\n      if (editor.isFocused()) {\n        try {\n          editor.select(JSON.parse(editorSelectionStr)); // 选中原来的位置\n        } catch (ex) {\n          editor.select(SlateEditor.start(editor, [])); // 选中开始\n        }\n      }\n    },\n\n    // 创建 editor\n    create() {\n      if (this.$refs.box == null) return;\n\n      const defaultConfig = this.defaultConfig || {};\n\n      const defaultContent = JSON.stringify(\n        Array.isArray(this.defaultContent) ? this.defaultContent : []\n      );\n\n      createEditor({\n        selector: this.$refs.box as Element,\n        html: this.defaultHtml || this.value || '',\n        config: {\n          ...defaultConfig,\n          onCreated: (editor) => {\n            this.editor = Object.seal(editor) as any; // 注意，一定要用 Object.seal() 否则会报错\n\n            this.$emit('onCreated', editor);\n            if (defaultConfig.onCreated) {\n              const info = genErrorInfo('onCreated');\n              throw new Error(info);\n            }\n          },\n          onChange: (editor) => {\n            const editorHtml = editor.getHtml()\n            this.curValue = editorHtml // 记录当前 html 内容\n            this.$emit('input', editorHtml); // 用于自定义 v-model\n\n            this.$emit('onChange', editor);\n            if (defaultConfig.onChange) {\n              const info = genErrorInfo('onChange');\n              throw new Error(info);\n            }\n          },\n          onDestroyed: (editor) => {\n            this.$emit('onDestroyed', editor);\n            if (defaultConfig.onDestroyed) {\n              const info = genErrorInfo('onDestroyed');\n              throw new Error(info);\n            }\n          },\n          onMaxLength: (editor) => {\n            this.$emit('onMaxLength', editor);\n            if (defaultConfig.onMaxLength) {\n              const info = genErrorInfo('onMaxLength');\n              throw new Error(info);\n            }\n          },\n          onFocus: (editor) => {\n            this.$emit('onFocus', editor);\n            if (defaultConfig.onFocus) {\n              const info = genErrorInfo('onFocus');\n              throw new Error(info);\n            }\n          },\n          onBlur: (editor) => {\n            this.$emit('onBlur', editor);\n            if (defaultConfig.onBlur) {\n              const info = genErrorInfo('onBlur');\n              throw new Error(info);\n            }\n          },\n          customAlert: (info, type) => {\n            this.$emit('customAlert', info, type);\n            if (defaultConfig.customAlert) {\n              const info = genErrorInfo('customAlert');\n              throw new Error(info);\n            }\n          },\n          customPaste: (editor, event) => {\n            if (defaultConfig.customPaste) {\n              const info = genErrorInfo('customPaste');\n              throw new Error(info);\n            }\n            let res;\n            this.$emit('customPaste', editor, event, (val: any) => {\n              res = val;\n            });\n            return res;\n          },\n        },\n        content: JSON.parse(defaultContent),\n        mode: this.mode || 'default',\n      });\n    },\n  },\n});\n</script>\n","<script lang=\"ts\">\nimport Vue from 'vue';\nimport { createToolbar, DomEditor } from '@wangeditor/editor';\n\nexport default Vue.extend({\n  name: 'Toolbar',\n  render(h) {\n    return h('div', { ref: 'box' });\n  },\n  props: ['editor', 'defaultConfig', 'mode'],\n  methods: {\n    // 创建 toolbar\n    create(editor: any) {\n      if (this.$refs.box == null) return;\n      if (editor == null) return;\n      if (DomEditor.getToolbar(editor)) return // 不重复创建\n\n      createToolbar({\n        editor,\n        selector: this.$refs.box as Element,\n        config: this.defaultConfig || {},\n        mode: this.mode || 'default',\n      });\n    },\n  },\n  watch: {\n    editor: {\n      handler(e) {\n        if (e == null) return;\n        this.create(e);\n      },\n      immediate: true,\n    }\n  }\n});\n</script>\n"],"names":["genErrorInfo","fnName","info","Vue","extend","render","h","ref","name","data","curValue","editor","props","mounted","this","create","watch","value","newVal","setHtml","methods","newHtml","isEditorDisabled","isDisabled","isEditorFocused","isFocused","editorSelectionStr","JSON","stringify","selection","enable","focus","select","deleteFragment","SlateTransforms","setNodes","type","mode","dangerouslyInsertHtml","deselect","blur","disable","parse","ex","SlateEditor","start","$refs","box","defaultConfig","defaultContent","Array","isArray","createEditor","selector","html","defaultHtml","config","onCreated","_this","Object","seal","$emit","Error","onChange","editorHtml","getHtml","onDestroyed","onMaxLength","onFocus","onBlur","customAlert","info_1","customPaste","event","res","val","content","DomEditor","getToolbar","createToolbar","handler","e","immediate"],"mappings":"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"}